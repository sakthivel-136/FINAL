# -*- coding: utf-8 -*-
"""mic_chat

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/19Ei3nfgH_cdVVbbmd-_EQurgt7s4rvQs
"""



import gradio as gr
import pandas as pd
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer
import speech_recognition as sr
import os

# Load the dataset
df = pd.read_csv("kamaraj_college_faq.csv")
df.dropna(inplace=True)

# Prepare the model
le = LabelEncoder()
df["Answer_Label"] = le.fit_transform(df["Answer"])

vectorizer = TfidfVectorizer()
X = vectorizer.fit_transform(df["Question"])
y = df["Answer_Label"]

model = LogisticRegression()
model.fit(X, y)

# Speech recognition from file
def transcribe_audio(audio_path):
    recognizer = sr.Recognizer()
    try:
        with sr.AudioFile(audio_path) as source:
            audio_data = recognizer.record(source)
            text = recognizer.recognize_google(audio_data)
            return text
    except Exception as e:
        print("Audio Transcription Error:", str(e))
        return ""

# Final prediction function
def get_answer(text_input, audio_input):
    # Prefer text input if provided
    if text_input and text_input.strip():
        question = text_input.strip()
    elif audio_input:
        question = transcribe_audio(audio_input)
        if question == "":
            return "‚ùå Could not understand the audio input."
    else:
        return "‚ö†Ô∏è Please provide a question via text or voice."

    # Predict
    try:
        vec = vectorizer.transform([question])
        label = model.predict(vec)[0]
        answer = le.inverse_transform([label])[0]
        return f"üü¢ Answer: {answer}"
    except Exception as e:
        print("Prediction Error:", str(e))
        return "‚ö†Ô∏è Something went wrong while predicting the answer."

# Gradio UI
iface = gr.Interface(
    fn=get_answer,
    inputs=[
        gr.Textbox(label="üìù Type your question"),
        gr.Audio(source="microphone", type="filepath", label="üé§ Or speak your question"),
    ],
    outputs="text",
    title="üéì Kamaraj College FAQ Chatbot",
    description="Ask your question about Kamaraj College by typing or speaking it!"
)

iface.launch()

    title="üéì Kamaraj College FAQ Chatbot",
    description="Ask questions related to Kamaraj College using text or voice."
)

iface.launch()
