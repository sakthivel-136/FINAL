# -*- coding: utf-8 -*-
"""mic_chat

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/19Ei3nfgH_cdVVbbmd-_EQurgt7s4rvQs
"""



import gradio as gr
import pandas as pd
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import LabelEncoder
from sklearn.feature_extraction.text import TfidfVectorizer
import speech_recognition as sr

# Load dataset
df = pd.read_csv("kcet.csv")  # ‚úÖ use correct CSV name
df.dropna(inplace=True)

# Encode answers
le = LabelEncoder()
df["Answer_Label"] = le.fit_transform(df["Answer"])

# Vectorize questions
vectorizer = TfidfVectorizer()
X = vectorizer.fit_transform(df["Question"])
y = df["Answer_Label"]

# Train model
model = LogisticRegression()
model.fit(X, y)

# Transcribe audio using SpeechRecognition
def transcribe_audio(audio_path):
    recognizer = sr.Recognizer()
    try:
        with sr.AudioFile(audio_path) as source:
            audio_data = recognizer.record(source)
            return recognizer.recognize_google(audio_data)
    except Exception as e:
        print("Transcription Error:", str(e))
        return ""

# Main prediction function
def get_answer(text_input, audio_input):
    if text_input and text_input.strip():
        question = text_input.strip()
    elif audio_input:
        question = transcribe_audio(audio_input)
        if not question:
            return "‚ùå Could not understand the audio input."
    else:
        return "‚ö†Ô∏è Please provide a question via text or voice."

    try:
        vector = vectorizer.transform([question])
        pred = model.predict(vector)[0]
        answer = le.inverse_transform([pred])[0]
        return f"üü¢ Answer: {answer}"
    except Exception as e:
        print("Prediction Error:", str(e))
        return "‚ö†Ô∏è Something went wrong during prediction."

# Gradio Interface
iface = gr.Interface(
    fn=get_answer,
    inputs=[
        gr.Textbox(label="üìù Type your question"),
        gr.Audio(source="microphone", type="filepath", label="üé§ Or speak your question"),
    ],
    outputs="text",
    title="üéì Kamaraj College FAQ Chatbot",
    description="Ask questions related to Kamaraj College using text or voice."
)

iface.launch()

